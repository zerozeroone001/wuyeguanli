<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.system.mapper.SysPropertyComplaintMapper">
    
    <resultMap type="SysPropertyComplaint" id="SysPropertyComplaintResult">
        <result property="complaintId"    column="complaint_id"    />
        <result property="complaintNo"    column="complaint_no"    />
        <result property="userId"    column="user_id"    />
        <result property="complaintType"    column="complaint_type"    />
        <result property="complaintTitle"    column="complaint_title"    />
        <result property="complaintContent"    column="complaint_content"    />
        <result property="contactPhone"    column="contact_phone"    />
        <result property="urgency"    column="urgency"    />
        <result property="expectedTime"    column="expected_time"    />
        <result property="status"    column="status"    />
        <result property="handlerId"    column="handler_id"    />
        <result property="handleTime"    column="handle_time"    />
        <result property="completeTime"    column="complete_time"    />
        <result property="satisfaction"    column="satisfaction"    />
        <result property="createBy"    column="create_by"    />
        <result property="createTime"    column="create_time"    />
        <result property="updateBy"    column="update_by"    />
        <result property="updateTime"    column="update_time"    />
    </resultMap>

    <sql id="selectSysPropertyComplaintVo">
        select complaint_id, complaint_no, user_id, complaint_type, complaint_title, complaint_content, contact_phone, urgency, expected_time, status, handler_id, handle_time, complete_time, satisfaction, create_by, create_time, update_by, update_time from sys_property_complaint
    </sql>

    <select id="selectSysPropertyComplaintList" parameterType="SysPropertyComplaint" resultMap="SysPropertyComplaintResult">
        <include refid="selectSysPropertyComplaintVo"/>
        <where>  
            <if test="complaintNo != null  and complaintNo != ''"> and complaint_no = #{complaintNo}</if>
            <if test="userId != null "> and user_id = #{userId}</if>
            <if test="complaintType != null  and complaintType != ''"> and complaint_type = #{complaintType}</if>
            <if test="complaintTitle != null  and complaintTitle != ''"> and complaint_title = #{complaintTitle}</if>
            <if test="complaintContent != null  and complaintContent != ''"> and complaint_content = #{complaintContent}</if>
            <if test="contactPhone != null  and contactPhone != ''"> and contact_phone = #{contactPhone}</if>
            <if test="urgency != null  and urgency != ''"> and urgency = #{urgency}</if>
            <if test="expectedTime != null  and expectedTime != ''"> and expected_time = #{expectedTime}</if>
            <if test="status != null  and status != ''"> and status = #{status}</if>
            <if test="handlerId != null "> and handler_id = #{handlerId}</if>
            <if test="handleTime != null "> and handle_time = #{handleTime}</if>
            <if test="completeTime != null "> and complete_time = #{completeTime}</if>
            <if test="satisfaction != null  and satisfaction != ''"> and satisfaction = #{satisfaction}</if>
        </where>
    </select>
    
    <select id="selectSysPropertyComplaintByComplaintId" parameterType="Long" resultMap="SysPropertyComplaintResult">
        <include refid="selectSysPropertyComplaintVo"/>
        where complaint_id = #{complaintId}
    </select>

    <insert id="insertSysPropertyComplaint" parameterType="SysPropertyComplaint" useGeneratedKeys="true" keyProperty="complaintId">
        insert into sys_property_complaint
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="complaintNo != null and complaintNo != ''">complaint_no,</if>
            <if test="userId != null">user_id,</if>
            <if test="complaintType != null and complaintType != ''">complaint_type,</if>
            <if test="complaintTitle != null and complaintTitle != ''">complaint_title,</if>
            <if test="complaintContent != null and complaintContent != ''">complaint_content,</if>
            <if test="contactPhone != null">contact_phone,</if>
            <if test="urgency != null">urgency,</if>
            <if test="expectedTime != null">expected_time,</if>
            <if test="status != null">status,</if>
            <if test="handlerId != null">handler_id,</if>
            <if test="handleTime != null">handle_time,</if>
            <if test="completeTime != null">complete_time,</if>
            <if test="satisfaction != null">satisfaction,</if>
            <if test="createBy != null">create_by,</if>
            <if test="createTime != null">create_time,</if>
            <if test="updateBy != null">update_by,</if>
            <if test="updateTime != null">update_time,</if>
         </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="complaintNo != null and complaintNo != ''">#{complaintNo},</if>
            <if test="userId != null">#{userId},</if>
            <if test="complaintType != null and complaintType != ''">#{complaintType},</if>
            <if test="complaintTitle != null and complaintTitle != ''">#{complaintTitle},</if>
            <if test="complaintContent != null and complaintContent != ''">#{complaintContent},</if>
            <if test="contactPhone != null">#{contactPhone},</if>
            <if test="urgency != null">#{urgency},</if>
            <if test="expectedTime != null">#{expectedTime},</if>
            <if test="status != null">#{status},</if>
            <if test="handlerId != null">#{handlerId},</if>
            <if test="handleTime != null">#{handleTime},</if>
            <if test="completeTime != null">#{completeTime},</if>
            <if test="satisfaction != null">#{satisfaction},</if>
            <if test="createBy != null">#{createBy},</if>
            <if test="createTime != null">#{createTime},</if>
            <if test="updateBy != null">#{updateBy},</if>
            <if test="updateTime != null">#{updateTime},</if>
         </trim>
    </insert>

    <update id="updateSysPropertyComplaint" parameterType="SysPropertyComplaint">
        update sys_property_complaint
        <trim prefix="SET" suffixOverrides=",">
            <if test="complaintNo != null and complaintNo != ''">complaint_no = #{complaintNo},</if>
            <if test="userId != null">user_id = #{userId},</if>
            <if test="complaintType != null and complaintType != ''">complaint_type = #{complaintType},</if>
            <if test="complaintTitle != null and complaintTitle != ''">complaint_title = #{complaintTitle},</if>
            <if test="complaintContent != null and complaintContent != ''">complaint_content = #{complaintContent},</if>
            <if test="contactPhone != null">contact_phone = #{contactPhone},</if>
            <if test="urgency != null">urgency = #{urgency},</if>
            <if test="expectedTime != null">expected_time = #{expectedTime},</if>
            <if test="status != null">status = #{status},</if>
            <if test="handlerId != null">handler_id = #{handlerId},</if>
            <if test="handleTime != null">handle_time = #{handleTime},</if>
            <if test="completeTime != null">complete_time = #{completeTime},</if>
            <if test="satisfaction != null">satisfaction = #{satisfaction},</if>
            <if test="createBy != null">create_by = #{createBy},</if>
            <if test="createTime != null">create_time = #{createTime},</if>
            <if test="updateBy != null">update_by = #{updateBy},</if>
            <if test="updateTime != null">update_time = #{updateTime},</if>
        </trim>
        where complaint_id = #{complaintId}
    </update>

    <delete id="deleteSysPropertyComplaintByComplaintId" parameterType="Long">
        delete from sys_property_complaint where complaint_id = #{complaintId}
    </delete>

    <delete id="deleteSysPropertyComplaintByComplaintIds" parameterType="String">
        delete from sys_property_complaint where complaint_id in 
        <foreach item="complaintId" collection="array" open="(" separator="," close=")">
            #{complaintId}
        </foreach>
    </delete>

    <select id="getComplaintStats" resultType="java.util.Map">
        select
            count(*) as total,
            count(case when status = '0' then 1 end) as pending,
            count(case when status = '1' then 1 end) as processing,
            count(case when status = '2' then 1 end) as completed
        from sys_property_complaint
    </select>
</mapper>
# 轮播图管理功能说明

## 功能概述

实现了完整的轮播图管理系统，包括后台管理和小程序端展示，支持链接到业主大会、意见征询或自定义页面。

---

## 一、数据库设计

### 表结构：`sys_banner`

| 字段名 | 类型 | 说明 |
|--------|------|------|
| banner_id | BIGINT(20) | 轮播图ID（主键） |
| banner_title | VARCHAR(100) | 轮播图标题 |
| banner_image | VARCHAR(500) | 轮播图图片URL |
| link_type | VARCHAR(20) | 链接类型：meeting-业主大会，opinion-意见征询，url-自定义链接 |
| link_id | BIGINT(20) | 关联的业务ID（业主大会ID或意见征询ID） |
| link_url | VARCHAR(500) | 自定义链接URL |
| sort_order | INT(4) | 显示顺序 |
| status | CHAR(1) | 状态（0正常 1停用） |
| community_id | BIGINT(20) | 小区ID |
| create_by | VARCHAR(64) | 创建者 |
| create_time | DATETIME | 创建时间 |
| update_by | VARCHAR(64) | 更新者 |
| update_time | DATETIME | 更新时间 |
| remark | VARCHAR(500) | 备注 |

### 导入SQL

**方式一：完整导入（推荐）**

执行完整脚本，包含数据库表、示例数据、菜单权限、角色权限：

```bash
mysql -u用户名 -p密码 数据库名 < sql/sys_banner_complete.sql
```

**方式二：分步导入**

1. 创建表和示例数据：
```bash
mysql -u用户名 -p密码 数据库名 < sql/sys_banner.sql
```

2. 导入菜单权限（自动版本）：
```bash
mysql -u用户名 -p密码 数据库名 < sql/sys_banner_menu_auto.sql
```

---

## 二A. 菜单权限配置

### 菜单结构

```
系统管理
└── 轮播图管理 (system:banner:list)
    ├── 轮播图查询 (system:banner:query)
    ├── 轮播图新增 (system:banner:add)
    ├── 轮播图修改 (system:banner:edit)
    ├── 轮播图删除 (system:banner:remove)
    └── 轮播图导出 (system:banner:export)
```

### 权限标识

| 权限名称 | 权限标识 | 说明 |
|---------|---------|------|
| 轮播图管理 | system:banner:list | 菜单访问权限 |
| 轮播图查询 | system:banner:query | 查询详情权限 |
| 轮播图新增 | system:banner:add | 新增轮播图权限 |
| 轮播图修改 | system:banner:edit | 修改轮播图权限 |
| 轮播图删除 | system:banner:remove | 删除轮播图权限 |
| 轮播图导出 | system:banner:export | 导出数据权限 |

### 自动分配

执行 `sys_banner_complete.sql` 会自动为管理员角色（role_id=1）分配所有轮播图管理权限。

### 手动分配

如需为其他角色分配权限：
1. 登录后台系统
2. 进入"系统管理" -> "角色管理"
3. 选择目标角色，点击"修改"
4. 在菜单权限树中勾选"轮播图管理"及相关按钮权限
5. 保存

---

## 二、后端实现

### 1. 实体类
- **位置**：`ruoyi-system/src/main/java/com/ruoyi/system/domain/SysBanner.java`
- **说明**：轮播图实体类，包含所有字段的getter/setter方法

### 2. Mapper层
- **Mapper接口**：`ruoyi-system/src/main/java/com/ruoyi/system/mapper/SysBannerMapper.java`
- **Mapper XML**：`ruoyi-system/src/main/resources/mapper/system/SysBannerMapper.xml`
- **功能**：
  - 查询轮播图列表
  - 查询单个轮播图
  - 新增轮播图
  - 修改轮播图
  - 删除轮播图（单个/批量）

### 3. Service层
- **接口**：`ruoyi-system/src/main/java/com/ruoyi/system/service/ISysBannerService.java`
- **实现**：`ruoyi-system/src/main/java/com/ruoyi/system/service/impl/SysBannerServiceImpl.java`

### 4. Controller层

#### 后台管理端
- **位置**：`ruoyi-admin/src/main/java/com/ruoyi/web/controller/system/SysBannerController.java`
- **接口路径**：`/system/banner`
- **权限标识**：
  - 查询：`system:banner:list`
  - 新增：`system:banner:add`
  - 修改：`system:banner:edit`
  - 删除：`system:banner:remove`
  - 导出：`system:banner:export`

#### 小程序端
- **位置**：`ruoyi-user/src/main/java/com/ruoyi/user/controller/BannerController.java`
- **接口路径**：`/banner/list`
- **说明**：只返回状态为正常（status=0）的轮播图，按排序字段排序

---

## 三、前端实现

### 1. 后台管理页面

#### API接口
- **位置**：`ruoyi-ui/src/api/system/banner.js`
- **方法**：
  - `listBanner(query)` - 查询列表
  - `getBanner(bannerId)` - 查询详情
  - `addBanner(data)` - 新增
  - `updateBanner(data)` - 修改
  - `delBanner(bannerId)` - 删除

#### 管理页面
- **位置**：`ruoyi-ui/src/views/system/banner/index.vue`
- **功能**：
  - 轮播图列表展示
  - 搜索筛选（标题、链接类型、状态）
  - 新增/编辑轮播图
  - 图片上传
  - 链接类型选择（业主大会/意见征询/自定义链接）
  - 排序设置
  - 状态管理
  - 批量删除

#### 页面特点
- 支持图片预览
- 根据链接类型动态显示相应的输入字段
- 表单验证
- 数据字典支持

### 2. 小程序端

#### API接口
- **位置**：`ruoyi-app/api/banner.js`
- **方法**：
  - `listBanner(query)` - 查询轮播图列表

#### 首页集成
- **位置**：`ruoyi-app/pages/index.vue`
- **修改内容**：
  1. 导入轮播图API
  2. 在`loadData()`中调用`getBannerList()`
  3. 实现`getBannerList()`方法获取轮播图数据
  4. 实现`handleBannerClick(banner)`方法处理点击事件

#### 跳转逻辑
```javascript
handleBannerClick(banner) {
  switch (banner.linkType) {
    case 'meeting':
      // 跳转到业主大会详情
      uni.navigateTo({
        url: `/pageB/property/meeting/detail?id=${banner.linkId}`
      });
      break;

    case 'opinion':
      // 跳转到意见征询详情
      uni.navigateTo({
        url: `/pages/work/opinion/detail?id=${banner.linkId}`
      });
      break;

    case 'url':
      // 自定义链接跳转
      uni.navigateTo({
        url: banner.linkUrl
      });
      break;
  }
}
```

---

## 四、使用流程

### 1. 初始化数据库和菜单权限

**推荐方式（一键完成）：**
```bash
# 执行完整SQL脚本，自动创建表、菜单、权限
mysql -u用户名 -p密码 数据库名 < sql/sys_banner_complete.sql
```

**分步方式：**
```bash
# 步骤1：创建表和示例数据
mysql -u用户名 -p密码 数据库名 < sql/sys_banner.sql

# 步骤2：导入菜单权限
mysql -u用户名 -p密码 数据库名 < sql/sys_banner_menu_auto.sql
```

### 2. 验证菜单权限

1. 登录后台管理系统
2. 进入"系统管理" -> "菜单管理"
3. 查看是否有"轮播图管理"菜单及子权限
4. 如果没有，检查SQL执行是否成功

### 3. 添加轮播图

1. 登录后台管理系统
2. 进入"系统管理" -> "轮播图管理"
3. 点击"新增"按钮
4. 填写表单：
   - **轮播图标题**：必填
   - **轮播图图片**：必填，点击上传
   - **链接类型**：
     - 无链接：仅展示，不跳转
     - 业主大会：输入业主大会ID
     - 意见征询：输入意见征询ID
     - 自定义链接：输入完整页面路径
   - **显示顺序**：数字越小越靠前
   - **状态**：正常/停用
5. 点击"确定"保存

### 4. 小程序端查看

1. 打开小程序
2. 首页顶部自动显示轮播图
3. 轮播图自动播放，3秒切换
4. 点击轮播图：
   - 如果设置了链接，自动跳转到对应页面
   - 如果没有链接，不进行跳转

---

## 五、功能特点

### 1. 后台管理
- ✅ 完整的CRUD操作
- ✅ 图片上传功能
- ✅ 多种链接类型支持
- ✅ 排序管理
- ✅ 状态控制
- ✅ 权限管理
- ✅ 搜索筛选

### 2. 小程序端
- ✅ 自动轮播（3秒切换）
- ✅ 循环播放
- ✅ 指示点显示
- ✅ 智能跳转
- ✅ 失败容错（API失败时显示默认轮播图）

### 3. 跳转支持
- ✅ 业主大会详情页
- ✅ 意见征询详情页
- ✅ 自定义页面路径
- ✅ 无链接（仅展示）

---

## 六、接口说明

### 后台管理接口

#### 1. 查询轮播图列表
```
GET /system/banner/list
参数：
  - pageNum: 页码
  - pageSize: 每页数量
  - bannerTitle: 标题（模糊查询）
  - linkType: 链接类型
  - status: 状态
```

#### 2. 查询轮播图详情
```
GET /system/banner/{bannerId}
```

#### 3. 新增轮播图
```
POST /system/banner
请求体：SysBanner对象
```

#### 4. 修改轮播图
```
PUT /system/banner
请求体：SysBanner对象
```

#### 5. 删除轮播图
```
DELETE /system/banner/{bannerIds}
```

### 小程序端接口

#### 查询轮播图列表
```
GET /banner/list
返回：正常状态的轮播图列表，按排序字段排序
```

---

## 七、注意事项

1. **图片上传**
   - 图片建议尺寸：750x360px（宽高比约2:1）
   - 支持格式：jpg、png、gif
   - 图片大小建议不超过500KB

2. **链接设置**
   - 业主大会ID：必须是已存在的业主大会记录ID
   - 意见征询ID：必须是已存在的意见征询记录ID
   - 自定义链接：必须是有效的小程序页面路径

3. **权限配置**
   - 需要给相应角色分配轮播图管理权限
   - 小程序端接口无需权限，但建议只返回正常状态的数据

4. **性能优化**
   - 建议轮播图数量不超过10张
   - 图片使用CDN存储
   - 合理设置排序顺序

---

## 八、文件清单

### 数据库
- ✅ `sql/sys_banner.sql` - 数据库表结构和初始数据
- ✅ `sql/sys_banner_menu.sql` - 菜单权限SQL（手动指定父菜单ID）
- ✅ `sql/sys_banner_menu_auto.sql` - 菜单权限SQL（自动查询父菜单ID）
- ✅ `sql/sys_banner_complete.sql` - 完整SQL（表+数据+菜单+权限）

### 后端文件
- ✅ `ruoyi-system/src/main/java/com/ruoyi/system/domain/SysBanner.java`
- ✅ `ruoyi-system/src/main/java/com/ruoyi/system/mapper/SysBannerMapper.java`
- ✅ `ruoyi-system/src/main/resources/mapper/system/SysBannerMapper.xml`
- ✅ `ruoyi-system/src/main/java/com/ruoyi/system/service/ISysBannerService.java`
- ✅ `ruoyi-system/src/main/java/com/ruoyi/system/service/impl/SysBannerServiceImpl.java`
- ✅ `ruoyi-admin/src/main/java/com/ruoyi/web/controller/system/SysBannerController.java`
- ✅ `ruoyi-user/src/main/java/com/ruoyi/user/controller/BannerController.java`

### 前端文件（后台管理）
- ✅ `ruoyi-ui/src/api/system/banner.js`
- ✅ `ruoyi-ui/src/views/system/banner/index.vue`

### 前端文件（小程序）
- ✅ `ruoyi-app/api/banner.js`
- ✅ `ruoyi-app/pages/index.vue`（修改）

---

## 九、测试步骤

### 1. 数据库测试
```sql
-- 查看表结构
DESC sys_banner;

-- 查询初始数据
SELECT * FROM sys_banner;
```

### 2. 后台管理测试
1. 登录后台系统
2. 访问轮播图管理页面
3. 测试新增、修改、删除功能
4. 测试搜索和筛选功能
5. 测试图片上传功能

### 3. 小程序测试
1. 启动小程序
2. 查看首页轮播图是否正常显示
3. 测试轮播图自动播放
4. 测试点击跳转功能（业主大会、意见征询、自定义链接）
5. 测试无链接轮播图（不跳转）

---

## 十、常见问题

### Q1: 轮播图不显示？
**A**:
1. 检查数据库中是否有status=0的轮播图数据
2. 检查小程序API接口是否正常
3. 查看浏览器控制台是否有错误信息
4. 确认图片URL是否可访问

### Q2: 点击轮播图无反应？
**A**:
1. 检查轮播图是否设置了linkType
2. 检查linkId或linkUrl是否有效
3. 确认目标页面是否存在
4. 查看控制台错误日志

### Q3: 图片上传失败？
**A**:
1. 检查文件大小是否超限
2. 检查文件格式是否支持
3. 检查后台上传接口是否正常
4. 确认上传路径是否有写权限

### Q4: 跳转页面不存在？
**A**:
1. 确认业主大会/意见征询记录是否存在
2. 检查页面路径是否正确
3. 确认pages.json中是否配置了该页面

---

## 十一、扩展建议

1. **点击统计**：添加点击次数统计功能
2. **定时发布**：支持定时上下线轮播图
3. **小区关联**：根据用户所属小区显示不同轮播图
4. **A/B测试**：支持多版本轮播图效果对比
5. **视频轮播**：支持视频类型的轮播内容

---

## 联系支持

如有问题，请查看系统日志或联系技术支持。
